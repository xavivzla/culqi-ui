<template>

<div class="separator">
  <div class="md-drawer-culqi" :class="[showMenu ? 'md-drawer-culqi-active': '']">

    <div class="md-drawer-culqi-logo">
      <svg
        width="76"
        height="24"
        viewBox="0 0 76 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M21.2518 23.8887C21.104 24.0368 20.8645 24.0354 20.7167 23.8874L9.19919 12.2989C7.96341 11.061 5.95168 11.0568 4.71727 12.2948L2.50436 10.078C4.95813 7.61993 8.95559 7.62267 11.4135 10.0849L22.957 21.6994C23.0911 21.8351 23.0911 22.0544 22.9556 22.1888L21.2518 23.8887Z"
          fill="#545454"
        />
        <path
          d="M18.6967 3.37163L16.6549 5.41568L16.4674 5.6035C13.2103 2.34069 7.9114 2.34069 4.65431 5.6035C4.38471 5.8722 4.13837 6.15599 3.91393 6.45074C3.90299 6.46582 3.89204 6.4809 3.88109 6.49598C3.87972 6.49735 3.87835 6.49872 3.87698 6.50009C3.77161 6.64404 3.57317 6.67283 3.43632 6.56452C3.42674 6.55767 3.41853 6.54944 3.40895 6.53985L1.60797 4.73707L1.58197 4.71103C1.58197 4.71103 1.5806 4.70966 1.5806 4.70828C1.49164 4.59861 1.48617 4.43958 1.57376 4.3258C1.5847 4.31072 1.59565 4.29564 1.60797 4.28193C1.65313 4.22572 1.69829 4.17088 1.74482 4.11467C1.95831 3.85831 2.18549 3.61017 2.42498 3.37026C6.91237 -1.12365 14.2107 -1.12365 18.6967 3.37163Z"
          fill="#545454"
        />
        <path
          d="M22.0661 11.5203C22.0661 14.5994 20.8686 17.4934 18.6954 19.6691C16.4524 21.916 13.5059 23.0388 10.5609 23.0388C7.61444 23.0388 4.668 21.916 2.42499 19.6691L4.65295 17.4372C7.91004 20.7 13.2103 20.7 16.4661 17.4372C18.044 15.8565 18.913 13.7549 18.913 11.5203C18.913 9.28568 18.044 7.18404 16.4661 5.60336L18.6954 3.37012C20.87 5.54715 22.0661 8.44255 22.0661 11.5203Z"
          fill="#545454"
        />
        <path
          d="M2.51121 19.7171C-0.143731 17.0575 -0.143731 12.7309 2.51121 10.0713L4.72411 12.2881C3.2899 13.7248 3.2899 16.0636 4.72411 17.5017L2.51121 19.7171Z"
          fill="#545454"
        />
        <path
          d="M31.952 12.2664C31.952 15.5306 34.1882 17.3429 36.3395 17.3429C37.8942 17.3429 39.4912 16.4902 40.4068 14.7409C40.4492 14.634 40.5765 14.5915 40.6627 14.6559L42.6224 15.9144C42.6867 15.9569 42.7292 16.0638 42.6867 16.1283C41.388 18.7947 38.9178 20.0532 36.4476 20.0532C32.7636 20.0532 29.0576 17.3018 29.0576 12.2664C29.0576 7.23232 32.7636 4.47949 36.4476 4.47949C38.9178 4.47949 41.388 5.73801 42.6867 8.40446C42.7292 8.4689 42.6867 8.57446 42.6224 8.61833L40.6627 9.87684C40.5778 9.94127 40.4492 9.89878 40.4068 9.79184C39.4912 8.04254 37.8942 7.18982 36.3395 7.18982C34.1663 7.18982 31.952 9.02412 31.952 12.2664Z"
          fill="#545454"
        />
        <path
          d="M43.813 16.4265C43.813 19.6907 46.624 20.8642 49.0517 19.3069L50.5421 18.3472C50.6912 18.2403 50.8185 18.3253 50.8185 18.4747V19.5632C50.8185 19.6482 50.9034 19.7332 50.9882 19.7332H53.416C53.5008 19.7332 53.5857 19.6482 53.5857 19.5632V9.23738C53.5857 9.15238 53.5008 9.06738 53.416 9.06738H50.9882C50.9034 9.06738 50.8185 9.15238 50.8185 9.23738V14.9967C50.8185 16.831 49.6689 17.7056 48.5618 17.7056C47.5395 17.7056 46.5816 17.1723 46.5816 15.5505V9.23738C46.5816 9.15238 46.4967 9.06738 46.4119 9.06738H43.9841C43.8993 9.06738 43.8144 9.15238 43.8144 9.23738V16.4265H43.813Z"
          fill="#545454"
        />
        <path
          d="M55.674 19.7329H58.1018C58.1866 19.7329 58.2715 19.6479 58.2715 19.5629V4.97078C58.2715 4.88578 58.1866 4.80078 58.1018 4.80078H55.674C55.5892 4.80078 55.5043 4.88578 55.5043 4.97078V19.5629C55.5043 19.6479 55.5892 19.7329 55.674 19.7329Z"
          fill="#545454"
        />
        <path
          d="M67.8977 10.6234V9.23743C67.8977 9.15243 67.9826 9.06744 68.0674 9.06744H70.4952C70.58 9.06744 70.6649 9.15243 70.6649 9.23743V23.8296C70.6649 23.9146 70.58 23.9996 70.4952 23.9996H68.0674C67.9826 23.9996 67.8977 23.9146 67.8977 23.8296V18.5392C67.8977 18.3692 67.7061 18.3048 67.5789 18.4323C66.7057 19.4563 65.4919 19.9677 64.449 19.9677C62.1061 19.9677 59.7646 18.1115 59.7646 14.4428C59.7646 11.2006 61.9364 8.83301 64.1726 8.83301C64.705 8.83301 65.3865 9.003 66.0256 9.51573L67.6227 10.7537C67.7486 10.8373 67.8977 10.7729 67.8977 10.6234ZM62.6385 14.4209C62.6385 16.0852 63.8099 17.4507 65.3427 17.4507C66.5785 17.4507 67.8977 16.1277 67.8977 14.3154C67.8977 12.2891 66.5141 11.2431 65.3632 11.2431C64.0015 11.2431 62.6385 12.2658 62.6385 14.4209Z"
          fill="#545454"
        />
        <path
          d="M73.7755 7.72271C74.7335 7.72271 75.4793 6.99749 75.4793 5.97341C75.4793 4.99182 74.7335 4.2666 73.7755 4.2666C72.7751 4.2666 72.0074 4.99182 72.0074 5.97341C72.0074 6.95499 72.7751 7.72271 73.7755 7.72271ZM72.5397 19.7334H74.9675C75.0523 19.7334 75.1372 19.6484 75.1372 19.5634V9.23759C75.1372 9.15259 75.0523 9.06759 74.9675 9.06759H72.5397C72.4549 9.06759 72.37 9.15259 72.37 9.23759V19.5621C72.37 19.6484 72.4549 19.7334 72.5397 19.7334Z"
          fill="#545454"
        />
      </svg>
    </div>

    <div class="md-drawer-culqi-header-icons">
      <md-menu md-size="medium" class="md-justify" >
        <span @click="showSupport = !showSupport">
          <md-icon class="md-pointer" >help_outline</md-icon>
          <md-tooltip md-direction="right" >Soporte</md-tooltip>
        </span>

        <template v-if="notificacionVisible">
          <span @click="showNotifications = !showNotifications">
            <md-icon class="md-pointer" >notifications_none</md-icon>
            <md-tooltip md-direction="right" >Notificaciones</md-tooltip>
          </span>
        </template>
      </md-menu>
    </div>

    <div class="md-menu-btn">
      <md-button class="md-icon-button" @click="menuMobile = true">
          <md-icon>menu</md-icon>
      </md-button>
    </div>

    <!-- Soporte -->
    <template v-if="showSupport">
      <div class="md-drawer-culqi-support">

        <div class="md-drawer-culqi-support__title">
          <span class="md-title-content">Soporte</span>
          <span class="md-pointer" @click="showSupport = false">
            <md-icon>
              close
            </md-icon>
          </span>
        </div>

        <div class="md-drawer-culqi-support__body"
        v-for="item in support"
        :key="item.title"
        >
          <md-ripple class="text-decoration-none">
            <a class="md-body-item md-pointer" :href="item.path">
              <md-icon class="md-size-3x">
                <img :src="item.img" :alt="item.alt">
              </md-icon>
              <div class="md-body-item-text">
                <span class="title">{{item.title}}</span>
                <span class="paragraph">{{item.paragraph}}</span>
              </div>
            </a>
          </md-ripple>

        </div>

        <div class="md-drawer-culqi-support__footer">
          <div class="md-footer-content">
            <span class="md-600">¿Aún tienes dudas?</span>
              <span class="text-decoration-none">
                <a href="hhtps://www.culqi.com">
                    www.culqi.com
                </a>
              </span>
            <span>{{numberPhoneCulqi}}</span>
          </div>
        </div>

      </div>
    </template>
    <!-- End Soporte -->

    <!-- Notifications -->
    <template v-if="showNotifications">
      <div class="md-drawer-culqi-notification">

        <div class="md-drawer-culqi-notification__title">
          <span class="md-title-content">Notificaciones</span>
          <span class="md-pointer" @click="showNotifications = false">
            <md-icon>
              close
            </md-icon>
          </span>
        </div>

        <div class="md-drawer-culqi-notification__body"
        v-for="item in notification"
        :key="item.title"
        >
          <md-ripple class="text-decoration-none">
            <a class="md-body-item md-pointer" :href="item.path">
              <md-icon class="md-size-3x">
                <img :src="item.img" :alt="item.alt">
              </md-icon>
              <div class="md-body-item-text">
                <span class="title">{{item.title}}</span>
                <span class="paragraph">{{item.paragraph}}</span>
              </div>
            </a>
          </md-ripple>

        </div>
        <template
        v-if="!notification.length"
        >
          <div class="notification-container">
            <div class="notification-container-content">
              <md-icon class="md-size-3x">
                <img :src="imgNotificationNone" alt="Cotificacion Culqi">
              </md-icon>
              <span class="notification-container-content-title">
                Aún no hay actividad
              </span>
              <span class="notification-container-content-paragraph">
                Te avisaremos cuando tengamos nuevas notificaciones para ti.
              </span>
            </div>
          </div>

        </template>
      </div>
    </template>
    <!-- End Notifications -->

    <!-- Menu mobile -->
    <template v-if="menuMobile">
      <div class="md-drawer-culqi-mobile" @click.self="menuMobile = false">

        <div class="md-drawer-culqi-mobile-content" >

          <md-avatar class="md-border">
            <img :src="currentMerchantImg" alt="People" />
          </md-avatar>

          <div class="md-drawer-culqi-mobile-header-bottom-text">
            <p class="md-drawer-culqi-mobile-merchant">{{currentMerchant}}</p>
          </div>

          <div class="md-drawer-culqi-mobile-list">
            <md-list :md-expand-single="expandSingle">
              <div v-for="nav in mdMenus" :key="nav.section">
                <span class="md-drawer-culqi-mobile-list-section">{{nav.section}}</span>
                  <md-list-item
                    v-for="item in nav.items"
                    :key="item.title"
                    :md-expand="Boolean(item.children && item.children.length)"
                    :to="item.patch"
                    :md-expanded="hasActiveExpand(item.children)"
                    :class="[
                      hasActive === item.patch && 'md-item-actived',
                      hasActiveExpand(item.children) && 'md-item-actived'
                    ]"
                  >
                  <md-icon><img :src="item.icon"></md-icon>
                  <span class="md-list-item-text">{{item.title}}</span>

                  <md-list slot="md-expand">
                    <md-list-item
                      v-for="itemChildren in item.children"
                      :key="itemChildren.title"
                      class="md-inset"
                      :to="itemChildren.patch"
                    >{{itemChildren.title}}</md-list-item>
                  </md-list>
                </md-list-item>
              </div>
            </md-list>
          </div>

          <div class="md-drawer-culqi-mobile-footer">
            <md-avatar class="md-avatar-icon md-accent md-border-redon">
              {{adminNameInitials}}
            </md-avatar>
            <div class="md-drawer-culqi-mobile-footer-text">
              <span class="md-drawer-culqi-mobile-footer-text-name">{{adminName}}</span>
              <span class="md-drawer-culqi-mobile-footer-text-sub">{{adminRole}}</span>
            </div>
          </div>

        </div>

      </div>
    </template>

    <!-- End Menu mobile -->

    <md-menu class="md-drawer-culqi-header-bottom" md-size="small" :md-offset-x="0" :md-offset-y="5" >
      <div class="md-avatar-arrow md-pointer"  md-menu-trigger>
          <md-avatar class="md-border">
            <img :src="currentMerchantImg" alt="People" />
          </md-avatar>
          <div class="md-arrow" md-align-trigge>
            <md-icon >keyboard_arrow_down</md-icon>
          </div>
      </div>

      <template v-if="merchants.length">
        <md-menu-content class="md-menu-merchants">
          <div class="md-menu-merchants-top">
            <span class="md-menu-merchants-top-change">CAMBIAR NEGOCIO</span>
          </div>

          <div class="md-menu-merchants-content md-scrollbar" v-for="nav in merchants" :key="nav.section">
            <div class="md-menu-merchants-title">
              <span class="md-merchant-account">Cuenta</span>
              <span class="md-merchant-title">{{nav.section}}</span>
            </div>

          <md-list-item
              v-for="item in nav.items"
              :key="item.title"
          >
            <md-menu-item class="md-item-menu-content" @click="changeMerchant(item)" >
                <md-avatar class="md-border">
                  <img :src="item.img">
                </md-avatar>
                <span class="md-name-merchant">
                  {{item.name}}
                </span>
            </md-menu-item>
          </md-list-item>
          </div>

        </md-menu-content>
      </template>

      <template v-if="!merchants.length">
        <md-menu-content class="md-menu-merchants">
          <div class="md-menu-merchants-top">
            <span class="md-menu-merchants-top-change" style="margin: 0 auto;">NO TIENES MÁS COMERCIOS</span>
          </div>
        </md-menu-content>
      </template>

    </md-menu>

    <div class="md-drawer-culqi-header-bottom-text">
      <p class="md-drawer-culqi-merchant">{{currentMerchant}}</p>
    </div>

    <div class="md-drawer-culqi-divider-action">
      <span></span>
      <div class="md-drawer-culqi-toggle" @click="_handleClickToggle">
        <md-icon class="md-toggle-arrow">west</md-icon>
      </div>
    </div>

    <div class="md-drawer-culqi-list">
      <md-list>
        <div v-for="(nav, index) in mdMenus" :key="index">
          <span class="md-drawer-culqi-list-section">{{nav.section}}</span>
          <md-list-item
            v-for="item in nav.items"
            :key="item.title"
            :md-expand="Boolean(item.children && item.children.length)"
            :to="item.patch"
            :md-expanded="hasActiveExpand(item.children)"
            :class="[
              hasActive === item.patch && 'md-item-actived',
              hasActiveExpand(item.children) && 'md-item-actived'
            ]"
          >
            <md-icon><img :src="item.icon"></md-icon>
            <span class="md-list-item-text">{{item.title}}</span>

            <md-list slot="md-expand">
              <md-list-item
                v-for="itemChildren in item.children"
                :key="itemChildren.title"
                class="md-inset"
                :class="[hasActive === itemChildren.patch && 'md-item-children-actived']"
                :to="itemChildren.patch"
              >{{itemChildren.title}}</md-list-item>
            </md-list>
          </md-list-item>
        </div>
      </md-list>
    </div>

    <div class="md-logo">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M21.4618 23.8887C21.314 24.0368 21.0745 24.0354 20.9267 23.8874L9.40918 12.2989C8.1734 11.061 6.16167 11.0568 4.92726 12.2948L2.71436 10.078C5.16812 7.61993 9.16558 7.62267 11.6235 10.0849L23.167 21.6994C23.3011 21.8351 23.3011 22.0544 23.1656 22.1888L21.4618 23.8887Z"
          fill="#545454"
        />
        <path
          d="M18.9065 3.37163L16.8647 5.41568L16.6772 5.6035C13.4201 2.34069 8.1212 2.34069 4.86411 5.6035C4.59451 5.8722 4.34818 6.15599 4.12374 6.45074C4.11279 6.46582 4.10185 6.4809 4.0909 6.49598C4.08953 6.49735 4.08816 6.49872 4.08679 6.50009C3.98142 6.64404 3.78298 6.67283 3.64613 6.56452C3.63655 6.55767 3.62834 6.54944 3.61876 6.53985L1.81778 4.73707L1.79178 4.71103C1.79178 4.71103 1.79041 4.70966 1.79041 4.70828C1.70145 4.59861 1.69598 4.43958 1.78356 4.3258C1.79451 4.31072 1.80546 4.29564 1.81778 4.28193C1.86294 4.22572 1.9081 4.17088 1.95463 4.11467C2.16812 3.85831 2.3953 3.61017 2.63479 3.37026C7.12218 -1.12365 14.4205 -1.12365 18.9065 3.37163Z"
          fill="#545454"
        />
        <path
          d="M22.2758 11.5208C22.2758 14.5999 21.0784 17.4939 18.9052 19.6696C16.6621 21.9165 13.7157 23.0393 10.7706 23.0393C7.82421 23.0393 4.87778 21.9165 2.63477 19.6696L4.86272 17.4377C8.11981 20.7005 13.4201 20.7005 16.6758 17.4377C18.2537 15.857 19.1228 13.7554 19.1228 11.5208C19.1228 9.28616 18.2537 7.18453 16.6758 5.60385L18.9052 3.37061C21.0797 5.54764 22.2758 8.44304 22.2758 11.5208Z"
          fill="#545454"
        />
        <path
          d="M2.72118 19.7171C0.0662456 17.0575 0.0662456 12.7309 2.72118 10.0713L4.93409 12.2881C3.49988 13.7248 3.49988 16.0636 4.93409 17.5017L2.72118 19.7171Z"
          fill="#545454"
        />
      </svg>
    </div>

    <div class="md-drawer-culqi-footer">

      <template v-if="!showMenu">

        <md-menu md-size="medium" :md-offset-x="127" :md-offset-y="-75" >
          <md-avatar class="md-avatar-icon md-accent md-pointer md-border-redon" md-menu-trigger>
            {{adminNameInitials}}
          </md-avatar>

          <md-menu-content class="md-menu-footer">
            <md-menu-item class="md-item-menu-content" @click="_handleMyAccount">
                <md-icon>store</md-icon>
                  Mi perfil
              </md-menu-item>
              <md-menu-item class="md-item-menu-content" @click="_handleLogout">
                <md-icon>exit_to_app</md-icon>
                  Cerrar sesión
              </md-menu-item>
          </md-menu-content>
        </md-menu>

      </template>

      <div class="md-flex">

        <template v-if="showMenu">
          <md-avatar class="md-avatar-icon md-accent md-border-redon">
            {{adminNameInitials}}
          </md-avatar>
        </template>
        <div class="md-drawer-culqi-footer-names">
          <span class="md-drawer-culqi-footer-name">{{adminName}}</span>
          <span class="md-drawer-culqi-footer-sub">{{adminRole}}</span>
        </div>
        <md-menu md-size="medium" class="md-justify" :md-offset-x="10" :md-offset-y="-150" >
          <md-button  md-menu-trigger>
            <md-icon>more_vert</md-icon>
          </md-button>

          <md-menu-content class="md-menu-footer">
            <md-menu-item class="md-item-menu-content" @click="_handleMyAccount">
                <md-icon>store</md-icon>
                  Mi perfil
              </md-menu-item>
              <md-menu-item class="md-item-menu-content" @click="_handleLogout">
                <md-icon>exit_to_app</md-icon>
                  Cerrar sesión
              </md-menu-item>
          </md-menu-content>
        </md-menu>
      </div>
    </div>
  </div>

</div>

</template>

<script>
import MdComponent from "core/MdComponent";

export default new MdComponent({
  name: "MdDrawerCulqi",
  props: {
    mdMenus: Array,
    merchants: Array,
    support: Array,
    notification: Array,
    notificacionVisible: Boolean,
    adminName: null,
    adminRole: null,
    currentMerchantImg: null,
    currentMerchant: null,
    adminNameInitials: null,
    numberPhoneCulqi: null,
    imgNotificationNone : String
  },
  data: () => ({
    showMenu: true,
    itemActived: false,
    menuMobile: false,
    showSupport: false,
    showNotifications: false,
  }),
  computed: {
    hasActive () {
      return this.$route.path
    }
  },
  methods: {
    changeMerchant (data) {
      this.$emit('changeMerchant', data)
    },
    hasActiveExpand (data) {
      if(data) {
        return data.map(({patch}) => patch).includes(this.$route.path)
      }
      return false
    },
    _handleClickToggle() {
      this.showMenu = !this.showMenu;
    },
    _handleMyAccount () {
      this.$emit("myAccount")
    },
    _handleLogout () {
      this.$emit("logout")
    },
    _handleClickCloseMerchant () {
      this.$emit("closeMerchant")
    },
    smallScreen(){
      if(window.innerWidth < 1024){
        return true
      }
      return false
    },
  },
});
</script>

<style lang="scss">
@keyframes openPrueba {
  from{
    left: -100%; }
  to {
    left: 0;}
}
// temporarl
.separator {
  display: inline-block;
  justify-content: space-between;
  @media screen and (max-width: 1024px){
   width: 100%;
  }
  .md-drawer-culqi {
    margin-bottom: 20px;
    .md-list-expand{
      background: #141414;
    }
    .md-list-item{
      padding: 0;
      &-content{
        padding: 0 16px;
      }
    }
  }
}
// end temporal
.md-menu-content {
  z-index: 1;
}
.md-notification {
  position: relative;
}
.md-menu-footer {
  box-shadow: none;
  min-width: 244px;
  width: 100%;
  .md-menu-content-container {
    border-radius: 4px;
    .md-list {
      background: #141414;
    }
    .md-item-menu-content {
      .md-list-item-content {
        color: #C2C2C2;
        justify-content: flex-start;
        padding: 4px 0;
        .md-icon {
          color: #888888;
          margin-right: 10px;
        }
        &:hover {
          background: rgba(255, 255, 255, 0.06);
        }
      }
    }
  }
}
.md-item-children-actived {
  .md-list-item-content {
    color: #3CB4E5 !important;
  }
}
.md-item-actived {
  position: relative;
  background: rgba(60, 180, 229, 0.12);
  .md-list-item-text {
      color: #3CB4E5;
  }
  &:before {
    content: '';
    width: 2px;
    height: 100%;
    background-color: #3CB4E5;
    position: absolute;
    left: 0;

  }
}

</style>
